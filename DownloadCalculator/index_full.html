<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Download Calculator</title>
    <link rel="stylesheet" href="style.min.css">
    <link href="https://fonts.googleapis.com/css?family=Maven+Pro&display=swap" rel="stylesheet">
  </head>
  <body>
    <header>
      <div style="padding: 50px;">
        <h1 class="big title">Download Calculator</h1>
      </div>
    </header>
    <header>
      <div class="container input">
        <div class="flex">
          <h6>Download Speed</h6>
          <div class="inputContainer">
            <input id="speed" type="text" name="" value="" onkeyup="updateUI(); window.localStorage.setItem('speed', this.value);">
            <select id="speedUnit" onchange="updateUnit(this); window.localStorage.setItem('speedUnit', this.value);">
              <option value="kb">kb</option>
              <option value="mb">mb</option>
              <option value="gb">gb</option>
              <option value="KB" selected="selected">KB</option>
              <option value="MB">MB</option>
              <option value="GB">GB</option>
            </select>
          </div>
        </div>
        <div class="flex">
          <h6>File Size</h6>
          <div class="inputContainer">
            <input id="size" type="text" name="" value="" onkeyup="updateUI()">
            <select id="sizeUnit" onchange="updateUnit(this);">
              <option value="KB">KB</option>
              <option value="MB">MB</option>
              <option value="GB" selected="selected">GB</option>
            </select>
          </div>
        </div>
      </div>
    </header>
    <header>
      <div class="container">
        <h6 class="small title">Donwloaded In</h6>
        <h3 id="result" style="text-align: center"></h3>
      </div>
    </header>
    <header>
      <div class="container">
        <h6 class="small title">1GB In</h6>
        <h3 id="1GBresult" style="text-align: center"></h3>
      </div>
    </header>
    <header>
      <div class="container">
        <h6 class="small title">In 1 Hour</h6>
        <h3 id="1HourResult" style="text-align: center"></h3>
      </div>
    </header>
    <script type="text/javascript">
    var speedUnit = 'KB',
        sizeUnit = 'GB';

    function tokb(value, unit) {
      switch (unit) {
        case "mb":
          return value * 1000;
          break;
        case "gb":
          return value * 1000000;
          break;
        case "KB":
          return value * 8;
          break;
        case "MB":
          return value * 8000;
          break;
        case "GB":
          return value * 8000000;
          break;
        default:
          return value;
      }
    }

    function downloadTime(customsize, customspeed) {
      if (customsize) {size = customsize} else {
        size = document.getElementById('size').value;
        size = tokb(size, sizeUnit);
      }
      if (customspeed) {speed = customspeed} else {
        speed = document.getElementById('speed').value;
        speed = tokb(speed, speedUnit);
      }
      return size / speed;
    }

    function downloadTimeText(seconds) {
      if (seconds == Infinity) return Infinity;
      if (isNaN(seconds)) return "";
      if (seconds < 1) return "less than a second";
      text = [];
      seconds = Math.trunc(seconds);

      function step(value, unit, ceiling, name) {
        time = Math.trunc(value / unit);
        if (time % ceiling == 0 || value < unit) return;
        if (time == 1 || time % ceiling == 1) {
          if (ceiling == 0) {
            text[text.length] = time + " " + name.substr(0, name.length - 1);
          } else {
            text[text.length] = time % ceiling + " " + name.substr(0, name.length - 1);
          }
        } else {
          if (ceiling == 0) {
            text[text.length] = time + " " + name;
          } else {
            text[text.length] = time % ceiling + " " + name;
          }
        }
      }

      step(seconds, 1, 60, "seconds");
      step(seconds, 60, 60, "minutes");
      step(seconds, 3600, 24, "hours");
      step(seconds, 86400, 0, "days");
      return text.reverse().join(" ");
    }

    function downloadSizeHour() {
      speed = document.getElementById('speed').value;
      speed = tokb(speed, speedUnit);
      kb = 3600 * speed;
      if (kb < 8) return kb.toFixed(2) + "kb";
      KB = kb / 8;
      if (kb < 8000) return KB.toFixed(2) + "KB";
      MB = kb / 8000;
      if (kb < 8000000) return MB.toFixed(2) + "MB";
      GB = kb / 8000000;
      return GB.toFixed(2) + "GB";
    }

    function changeUnit(element) {
      if (element.id == "speedUnit") {
        speedUnit = element.value;
      } else { // size
        sizeUnit = element.value;
      }
    }

    function updateUnit(element) {
      changeUnit(element);
      updateUI();
    }

    function updateUI() {
      document.getElementById('result').innerText = downloadTimeText(downloadTime());
      document.getElementById('1HourResult').innerText = downloadSizeHour();
      document.getElementById('1GBresult').innerText = downloadTimeText(downloadTime(8000000));
    }
    changeUnit(document.getElementById('sizeUnit'));
    document.getElementById('speed').value = window.localStorage.getItem('speed');
    if (window.localStorage.getItem('speedUnit')) {
      document.getElementById('speedUnit').value = window.localStorage.getItem('speedUnit');
    }
    changeUnit(document.getElementById('speedUnit'));
    updateUI();
    </script>
  </body>
</html>
