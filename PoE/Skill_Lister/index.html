<!DOCTYPE html>
<html lang="en" dir="ltr" style="height: 100%">
  <head>
    <meta charset="utf-8">
    <title>PoE skill lister</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript">
      function lightTheme() {
        document.documentElement.style.setProperty('--background-color', "rgb(255, 255, 255)");
        document.documentElement.style.setProperty('--background-color-70', "rgba(255, 255, 255, 0.7)");
        document.documentElement.style.setProperty('--background-color-50', "rgba(255, 255, 255, 0.5)");
        document.documentElement.style.setProperty('--background-color-30', "rgba(255, 255, 255, 0.3)");
        document.documentElement.style.setProperty('--background-low-contrast', "rgb(249, 249, 249)");
        document.documentElement.style.setProperty('--background-contrast', "rgb(244, 244, 244)");
        document.documentElement.style.setProperty('--text', "#222");
        document.documentElement.style.setProperty('--link', "#1EAEDB");
        document.documentElement.style.setProperty('--link-hover', "#0FA0CE");
      }

      function darkTheme() {
        document.documentElement.style.setProperty('--background-color', "rgb(45, 45, 45)");
        document.documentElement.style.setProperty('--background-color-70', "rgba(45, 45, 45, 0.7)");
        document.documentElement.style.setProperty('--background-color-50', "rgba(45, 45, 45, 0.5)");
        document.documentElement.style.setProperty('--background-color-30', "rgba(45, 45, 45, 0.3)");
        document.documentElement.style.setProperty('--background-low-contrast', "rgb(42, 42, 42)");
        document.documentElement.style.setProperty('--background-contrast', "rgb(35, 35, 35)");
        document.documentElement.style.setProperty('--text', "#dfdfdf");
        document.documentElement.style.setProperty('--link', "#1EAEDB");
        document.documentElement.style.setProperty('--link-hover', "#0FA0CE");
      }

      if (window.localStorage.getItem('theme') == null) {
        window.localStorage.setItem('theme', 'light');
      } else if (window.localStorage.getItem('theme') == 'dark') {
        darkTheme();
      }

      function switchTheme() {
        if (window.localStorage.getItem('theme') == 'light') {
          window.localStorage.setItem('theme', 'dark');
          darkTheme();
          document.getElementById("toDarkTheme").style.display = "none";
          document.getElementById("toLightTheme").style.display = "block";
        } else {
          window.localStorage.setItem('theme', 'light');
          lightTheme();
          document.getElementById("toLightTheme").style.display = "none";
          document.getElementById("toDarkTheme").style.display = "block";
        }
      }
  </script>
  </head>
  <body style="height: 100%">
    <div class="theme-toggle" onclick="switchTheme()">
      <img id="toDarkTheme" src="img/dark-theme.svg" style="display: none;">
      <img id="toLightTheme" src="img/light-theme.svg" style="display: block;">
    </div>
    <header style="background: linear-gradient(to top right, #3399ff 0%, #00ffcc 100%);padding: 0;margin: 0;line-height: 0;">
      <h1 class="separator title">Path of Exile Skill Lister</h1>
    </header>
    <div class="container">
      <h6>Basic</h6>
      <button class="chip" onclick="toggleType(this);">Attack</button>
      <button class="chip" onclick="toggleType(this);">Melee</button>
      <button class="chip" onclick="toggleType(this);">Spell</button>
    </div>
    <div class="container">
      <h6>Weapon Type</h6>
      <button class="chip" onclick="toggleType(this);">Two-Handed</button>
      <button class="chip" onclick="toggleType(this);">One-Handed</button>
      <button class="chip" onclick="toggleType(this);">Dual-Wielding</button>
      <button class="chip" onclick="toggleType(this);">Axe</button>
      <button class="chip" onclick="toggleType(this);">Sword</button>
      <button class="chip" onclick="toggleType(this);">Mace</button>
      <button class="chip" onclick="toggleType(this);">Claw</button>
      <button class="chip" onclick="toggleType(this);">Dagger</button>
      <button class="chip" onclick="toggleType(this);">Staff</button>
      <button class="chip" onclick="toggleType(this);">Wand</button>
      <button class="chip" onclick="toggleType(this);">Bow</button>
      <button class="chip" onclick="toggleType(this);">Spectre</button>
      <button class="chip" onclick="toggleType(this);">Unarmed</button>
    </div>
    <div class="container">
      <h6>Element</h6>
      <button class="chip" onclick="toggleType(this);">Chaos</button>
      <button class="chip" onclick="toggleType(this);">Cold</button>
      <button class="chip" onclick="toggleType(this);">Fire</button>
      <button class="chip" onclick="toggleType(this);">Physical</button>
      <button class="chip" onclick="toggleType(this);">Lightning</button>
    </div>
    <div class="container">
      <h6>Gem Tag</h6>
      <button class="chip" onclick="toggleType(this);">AoE</button>
      <button class="chip" onclick="toggleType(this);">Aura</button>
      <button class="chip" onclick="toggleType(this);">Blink</button>
      <button class="chip" onclick="toggleType(this);">Brand</button>
      <button class="chip" onclick="toggleType(this);">Chaining</button>
      <button class="chip" onclick="toggleType(this);">Channelling</button>
      <button class="chip" onclick="toggleType(this);">Curse</button>
      <button class="chip" onclick="toggleType(this);">Duration</button>
      <button class="chip" onclick="toggleType(this);">Golem</button>
      <button class="chip" onclick="toggleType(this);">Guard</button>
      <button class="chip" onclick="toggleType(this);">Mine</button>
      <button class="chip" onclick="toggleType(this);">Minion</button>
      <button class="chip" onclick="toggleType(this);">Movement</button>
      <button class="chip" onclick="toggleType(this);">Projectile</button>
      <button class="chip" onclick="toggleType(this);">Strike</button>
      <button class="chip" onclick="toggleType(this);">Support</button>
      <button class="chip" onclick="toggleType(this);">Totem</button>
      <button class="chip" onclick="toggleType(this);">Trap</button>
      <button class="chip" onclick="toggleType(this);">Travel</button>
      <button class="chip" onclick="toggleType(this);">Trigger</button>
      <button class="chip" onclick="toggleType(this);">Vaal</button>
      <button class="chip" onclick="toggleType(this);">Warcry</button>
    </div>
    <header>
      <div class="container">
        <h4>Matching Skills:</h4>
        <div id="skilllist">
          <div class="skill">
            <img src="img/skill/Artillery_Ballista.png">
            <p>Artillery Ballista</p>
          </div>

          <div class="skill">
            <img src="img/skill/Artillery_Ballista.png">
            <p>Artillery Ballista</p>
          </div>
          <div class="skill">
            <img src="img/skill/Artillery_Ballista.png">
            <p>Artillery Ballista</p>
          </div>
          <div class="skill">
            <img src="img/skill/Artillery_Ballista.png">
            <p>Artillery Ballista</p>
          </div>

        </div>
      </div>
    </header>
    <header style="height: 100%"></header>
  </body>
  <script type="text/javascript">
    skillListElement = document.getElementById('skilllist');
    var skills;
    getAndDisplaySkills();
    toggledTypes = [];
    function toggleType(button) {
      button.classList.toggle('selected');
      for (var i = 0; i < toggledTypes.length; i++) {
        if (toggledTypes[i] == button.innerText) {
          console.log('removed ' + toggledTypes[i]);
          toggledTypes.splice(i, 1);
          filterSkills();
          return;
        }
      }

      console.log('added ' + button.innerText);
      toggledTypes.push(button.innerText);
      filterSkills();
    }

    function filterSkills() {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          skills = JSON.parse(this.responseText);

          if (toggledTypes.length == 0) {
            displaySkills();
            return;
          }

          for (var i = 0; i < toggledTypes.length; i++) {
            for (var o = 0; o < skills.skills.length; o++) {
              for (var p = 0; p < skills.skills[o].tags.length; p++) {
                if (skills.skills[o].tags[p] == toggledTypes[i]) {
                  break;
                }
                if (p == skills.skills[o].tags.length - 1) {
                  skills.skills.splice(o, 1);
                  o--;
                  break;
                }
              }
            }
          }
          displaySkills();

        }
      };
      xmlhttp.open("GET", "data.json", true);
      xmlhttp.send();
    }

    function displaySkills() {
      result = '';
      if (skills.skills.length == 0) {
        skillListElement.innerHTML = result;
        return;
      }
      for (var i = 0; i < skills.skills.length; i++) {
        result += "<div class='skill' onclick='wikiLink(this)'><img src=" + '"' + "img/skill/" + skills.skills[i].image + '"' + "><p>" + skills.skills[i].name + "</p></div>"
      }
      skillListElement.innerHTML = result;
    }

    function getAndDisplaySkills() {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          skills = JSON.parse(this.responseText);
          displaySkills();
        }
      };
      xmlhttp.open("GET", "data.json", true);
      xmlhttp.send();
    }

    function wikiLink(skill) {
      skillname = skill.getElementsByTagName('p')[0].innerText.replace(/ /g, '_');
      window.open('https://pathofexile.gamepedia.com/' + skillname);
    }
  </script>
</html>
