<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Speeddial</title>
  <meta name="description" content="">
  <meta name="author" content="AQtun">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Maven+Pro&amp;display=swap" rel="stylesheet">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="../css/normalize.css">
  <link rel="stylesheet" href="../css/skeleton.css">
  <link rel="stylesheet" href="style.css">

  <script type="text/javascript">
    function getCookie(name) {
      var cookies = document.cookie.split('; ');
      for (var cookie of cookies) {
        cookie = cookie.split('=');
        if (cookie[0] == name) {
          return cookie[1];
        }
      }
      return null;
    }

    function deleteCookie(name) {
      document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    }

    function addCookie(name, value) {
      var date = new Date();
      date.setTime(date.getTime() + (2592000000));
      document.cookie = name + "=" + value + "; expires=" + date.toUTCString() + "; path=/";
    }
  </script>
</head>
<body>
  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <header>
    <h1 class="separator title">injected humour</h1>
  </header>
  <div id="websites"></div>

  <script type="text/javascript">
    var targetName,
        targetUrl;

    function addContextMenuEvent(element) {
      element.addEventListener('contextmenu', function(ev) {
          var menu = document.getElementById('contextMenu');
          ev.preventDefault();
          targetName = this.firstChild.innerText;
          targetUrl = this.attributes.href.nodeValue;

          document.getElementById('contextMenuEdit').children[1].innerText = "Edit " + targetName;
          document.getElementById('contextMenuRemove').children[1].innerText = "Remove " + targetName;
          document.getElementById('removeWebsiteButton').innerText = "Remove " + targetName;

          menu.style.display = "block";
          menu.style.left = ev.clientX + 'px';
          menu.style.top = ev.clientY + window.scrollY + 'px';
          return false;
      }, false);
    }

    var websitesElement = document.getElementById('websites');
    function displayWebsiteTile(name, url) {
      websitesElement.innerHTML += '<div class="tile" href="' + url + '" onclick="openUrl(this.attributes.href.nodeValue)"><h4>' + name + '</h4></div>';
    }

    if (localStorage.getItem("websites") != null) {
      var localWebsites = localStorage.getItem("websites").split(',');
      for (website of localWebsites) {
        website = website.split('=');
        displayWebsiteTile(website[0], website[1])
      }
    }

    function refreshContextMenuEvents() {
      for (tile of document.getElementsByClassName('tile')) {
        addContextMenuEvent(tile);
      }
    }

    refreshContextMenuEvents();
  </script>

  <img id="settingsButton" class="toggle" onclick="openSettings()" src="img/settings.svg">
  <img id="addButton" class="toggle" onclick="openAddMenu()" src="img/add.svg">
  <div id="add" class="menu">
    <img id="closeAddButton" onclick="closeAddMenu()" src="img/close.svg" class="toggle">
    <h5>add website</h5>
    <label>Name</label>
    <input class="u-full-width" type="text" placeholder="google" id="add-name">
    <label>URL</label>
    <input class="u-full-width" type="url" placeholder="https://www.google.com/" id="add-url">
    <button onclick="addWebsite()">Add</button>
  </div>
  <div id="remove" class="menu">
    <h5>are you sure?</h5>
    <img id="closeRemoveButton" onclick="closeRemoveMenu()" src="img/close.svg" class="toggle">
    <button id="removeWebsiteButton" onclick="removeWebsite(targetName, targetUrl); closeRemoveMenu()">Remove ...</button>
  </div>
  <div id="settings" class="menu">
    <img id="closeSettingsButton" onclick="closeSettings()" src="img/close.svg" class="toggle">
    <h5>settings</h5>
    <label>Background</label>
    <input class="u-full-width" type="text" placeholder="url(), color, gradient">
    <input type="radio" name="showImages" value="false">
    <input type="radio" name="showImages" value="true">
    <button>Apply</button>
  </div>
  <div id="contextMenu">
    <table class="u-full-width" style="margin: 0;">
      <tbody>
        <tr>
          <td id="contextMenuAdd" onclick="openAddMenu()"><img src="img/add.svg"><bdo>Add New</bdo></td>
        </tr>
        <tr>
          <td id="contextMenuEdit" onclick="openEditMenu()"><img src="img/edit.svg"><bdo>Edit</bdo></td>
        </tr>
        <tr>
          <td id="contextMenuRemove" onclick="openRemoveMenu()"><img src="img/delete.svg"><bdo>Remove</bdo></td>
        </tr>
      </tbody>
    </table>
  </div>


<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script type="text/javascript">

    /* CONTEXT MENU
    ---------------------------------------------*/

    document.addEventListener('mouseup', function(ev) {
      document.getElementById('contextMenu').style.display = "none";
    }, false);

    /* OPENING AND CLOSING MENUS
    ---------------------------------------------*/

    var addMenu = document.getElementById("add");
    var settings = document.getElementById("settings");
    var removeMenu = document.getElementById('remove');
    var addMenuOpen = false;
    var settingsOpen = false;

    function openAddMenu() {
      if (addMenuOpen) {
        closeAddMenu();
      } else {
        addMenuOpen = true;
        addMenu.style.animationName = "openMenu";
        addMenu.style.animationDuration = "0.25s";
        if (settingsOpen) {
          closeSettings();
        }
      }
    }

    function closeAddMenu() {
      addMenu.style.animationName = "closeMenu";
      addMenu.style.animationDuration = "0.25s";
      addMenuOpen = false;
      document.getElementById("add-name").value = "";
      document.getElementById("add-url").value = "";
    }

    function openSettings() {
      if (settingsOpen) {
        closeSettings();
      } else {
        settingsOpen = true;
        settings.style.animationName = "openSettings";
        settings.style.animationDuration = "0.25s";
        if (addMenuOpen) {
          closeAddMenu();
        }
      }
    }

    function closeSettings() {
      settings.style.animationName = "closeSettings";
      settings.style.animationDuration = "0.25s";
      settingsOpen = false;
    }

    function openRemoveMenu() {
      removeMenu.style.animationName = "openMenu";
      removeMenu.style.animationDuration = "0.25s";
    }

    function closeRemoveMenu() {
      removeMenu.style.animationName = "closeMenu";
      removeMenu.style.animationDuration = "0.25s";
    }

    /* ADDING WEBSITES
    ---------------------------------------------*/

    function addWebsite() {
      var name = document.getElementById("add-name").value;
      var url = document.getElementById("add-url").value;
      if (localStorage.getItem("websites") != null) {
        localStorage.setItem('websites', localStorage.getItem('websites') + ',' + name + '=' + url);
      } else {
        localStorage.setItem('websites', name + '=' + url);
      }
      closeAddMenu();
      displayWebsiteTile(name, url);
      tile = document.getElementsByClassName('tile')[document.getElementsByClassName('tile').length - 1];
      setWebsiteLogo(tile, getHost(tile.attributes.href.nodeValue));
      refreshContextMenuEvents();
    }

    function removeWebsiteTile(name, url) {
      var tiles = document.getElementsByClassName('tile');
      for (tile of tiles) {
        if (tile.children[0].innerText == name) {
          if (tile.attributes.href.nodeValue == url) {
            tile.remove();
            return
          }
        }
      }
      refreshContextMenuEvents();
    }

    function removeWebsite(name, url) {
      if (!localStorage.getItem('websites').endsWith((name + '=' + url))) {
        localStorage.setItem('websites', localStorage.getItem('websites').replace(name + '=' + url + ',', ''));
        removeWebsiteTile(name, url);
      } else {
        if (localStorage.getItem('websites').search(',') > -1) {
          localStorage.setItem('websites', localStorage.getItem('websites').replace(new RegExp(',' + name + '=' + url + '$'), ''));
          removeWebsiteTile(name, url);
        } else if (localStorage.getItem('websites') == name + '=' + url) {
          localStorage.removeItem('websites');
          removeWebsiteTile(name, url);
        }
      }
    }

    /* SEARCH
    ---------------------------------------------*/

    function openUrl(url) {
      window.open(url, "_self")
    }

  </script>
  <script type="text/javascript">
    function getHost(url) {
      var result = url.match(/([^:\/\s]+)/g);
      if (result[0] == undefined || result[0] == null) {
        return
      }
      if (result[1] == undefined || result[1] == null) {
        if (result[0].match('.://')) {
          return
        }
        return result[0]
      }
      if (result[1].startsWith('www.')) {
        return result[1].substring(4, result[1].length)
      }
      return result[1]
    }

    var logoDatabase = ['google.com', 'youtube.com', 'music.youtube.com', 'twitter.com', 'docs.google.com', 'imdb.com', 'mail.google.com', 'reddit.com', 'twitch.tv'];

    function isWebsiteLogoAvailable(host) {
      for (logo of logoDatabase) {
        if (host == logo) {
          return true
        }
      }
      return false
    }

    function setWebsiteLogo(element, host) {
      if (isWebsiteLogoAvailable(host)) {
        element.style.backgroundImage = 'url("img/logo/' + host + '.png")';
        element.classList.add('image');
      }
    }

    var tiles = document.getElementsByClassName('tile');
    for (tile of tiles) {
      setWebsiteLogo(tile, getHost(tile.attributes.href.nodeValue));
    }


  </script>
</body>
</html>
