<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <title>Speeddial</title>
  <meta name="description" content="">
  <meta name="author" content="AQtun">

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Maven+Pro&amp;display=swap" rel="stylesheet">

  <link rel="stylesheet" href="normalize.css">
  <link rel="stylesheet" href="skeleton.css">
  <link rel="stylesheet" href="style.min.css">

  <script type="text/javascript">
    /* THEME
    ---------------------------------------------*/

    function displayDarkTheme(themeIcons) {
      document.documentElement.style.setProperty('--background-color', "#000b");
      document.documentElement.style.setProperty('--background-color-popup', "#222");
      document.documentElement.style.setProperty('--icon-color', "#fff");
      document.documentElement.style.setProperty('--background-low-contrast', "rgb(40, 40, 40)");
      document.documentElement.style.setProperty('--background-contrast', "rgb(15, 15, 15)");
      document.documentElement.style.setProperty('--table-border', "#3e3e3e");
      document.documentElement.style.setProperty('--text', "#ddd");
      document.documentElement.style.setProperty('--text-low-contrast', "#ccc");
      document.documentElement.style.setProperty('--text-contrast', "#aaa");

      if (themeIcons) {
        document.getElementById('closeSettingsButton').src = 'img/close-dark.svg';
        document.getElementById('closeAddButton').src = 'img/close-dark.svg';
        document.getElementById('closeRemoveButton').src = 'img/close-dark.svg';
        document.getElementById('closeEditButton').src = 'img/close-dark.svg';
        document.getElementById('searchIcon').src = 'img/search-dark.svg';

        document.getElementById('contextMenuAdd').firstElementChild.src = 'img/add-dark.svg';
        document.getElementById('contextMenuEdit').firstElementChild.src = 'img/edit-dark.svg';
        document.getElementById('contextMenuRemove').firstElementChild.src = 'img/delete-dark.svg';
      }

    }

    function displayLightTheme(themeIcons) {
      document.documentElement.style.setProperty('--background-color', "#fffb");
      document.documentElement.style.setProperty('--background-color-popup', "#fff");
      document.documentElement.style.setProperty('--icon-color', "#000");
      document.documentElement.style.setProperty('--background-low-contrast', "rgb(249, 249, 249)");
      document.documentElement.style.setProperty('--background-contrast', "rgb(244, 244, 244)");
      document.documentElement.style.setProperty('--table-border', "#e1e1e1");
      document.documentElement.style.setProperty('--text', "#222");
      document.documentElement.style.setProperty('--text-low-contrast', "#333");
      document.documentElement.style.setProperty('--text-contrast', "#555");

      if (themeIcons) {
        document.getElementById('closeSettingsButton').src = 'img/close.svg';
        document.getElementById('closeAddButton').src = 'img/close.svg';
        document.getElementById('closeRemoveButton').src = 'img/close.svg';
        document.getElementById('closeEditButton').src = 'img/close.svg';
        document.getElementById('searchIcon').src = 'img/search.svg';

        document.getElementById('contextMenuAdd').firstElementChild.src = 'img/add.svg';
        document.getElementById('contextMenuEdit').firstElementChild.src = 'img/edit.svg';
        document.getElementById('contextMenuRemove').firstElementChild.src = 'img/delete.svg';
      }

    }

    if (window.localStorage.getItem('theme') == 'dark') {
      displayDarkTheme(false);
    }

    function displayDarkBackgroundButtons() {
      document.getElementById('addButton').src = 'img/add.svg';
      document.getElementById('settingsButton').src = 'img/settings.svg';
    }

    function displayLightBackgroundButtons() {
      document.getElementById('addButton').src = 'img/add-dark.svg';
      document.getElementById('settingsButton').src = 'img/settings-dark.svg';
    }

    if (window.localStorage.getItem('backgroundButtons') == 'light') {
      displayLightBackgroundButtons();
    }
  </script>

</head>
<body onkeyup="return SearchKey(event)">
  <header style="position: fixed; width: 100%;">
    <div id="searchBody">
      <div id="search">
        <table class="u-full-width" style="margin: 0;">
          <tbody>
            <tr>
              <td style="padding: 0px;">
                <input id="searchInput" onkeyup="getQuery(event, this.value)" type="text" placeholder="Search with Google">
                <img id="searchIcon" src="img/search.svg" onclick="SearchGoogle(document.getElementById('searchInput').value)">
              </td>
            </tr>
            <tr>
              <td onclick="SearchSuggestion(this.innerText)"></td>
            </tr>
            <tr>
              <td onclick="SearchSuggestion(this.innerText)"></td>
            </tr>
            <tr>
              <td onclick="SearchSuggestion(this.innerText)"></td>
            </tr>
            <tr>
              <td onclick="SearchSuggestion(this.innerText)"></td>
            </tr>
            <tr>
              <td onclick="SearchSuggestion(this.innerText)"></td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </header>
  <div id="websites"></div>
  <script type="text/javascript">
    /* CONTENT
    ---------------------------------------------*/

    if (window.localStorage.getItem('searchEngine') != null || window.localStorage.getItem('searchEngine') != undefined) {
      document.getElementById('searchInput').placeholder = "Search with " + window.localStorage.getItem('searchEngine');
    }

    var targetName,
        targetUrl;

    function addContextMenuEvent(element) {
      element.addEventListener('contextmenu', function(ev) {
          var menu = document.getElementById('contextMenu');
          ev.preventDefault();
          targetName = this.firstChild.innerText;
          targetUrl = this.attributes.href.nodeValue;

          document.getElementById('contextMenuEdit').children[1].innerText = "Edit " + targetName;
          document.getElementById('contextMenuRemove').children[1].innerText = "Remove " + targetName;
          document.getElementById('removeWebsiteButton').innerText = "Remove " + targetName;
          document.getElementById('editWebsiteButton').innerText = "Edit " + targetName;
          document.getElementById('editNameInput').value = targetName;
          document.getElementById('editURLInput').value = targetUrl;

          menu.style.display = "block";
          menu.style.left = ev.pageX + 'px';
          if (ev.clientY > window.innerHeight - 200) {
            menu.style.top = ev.pageY - 155 + 'px';
          } else {
            menu.style.top = ev.pageY + 'px';
          }
          return false;
      }, false);
    }

    function addMiddlemouseEvent(element) {
      element.addEventListener('mouseup', e => {
      	if (e.button == 1) {
          openUrlNewTab(element.attributes.href.nodeValue);
        }
      });
    }

    var websitesElement = document.getElementById('websites');
    function displayWebsiteTile(name, url) {
      websitesElement.innerHTML += '<div class="tile" href="' + url + '" onclick="openUrl(this.attributes.href.nodeValue)"><h4>' + name + '</h4></div>';
    }

    if (localStorage.getItem("websites") != null) {
      var localWebsites = localStorage.getItem("websites").split(',');
      for (website of localWebsites) {
        website = website.split('=');
        displayWebsiteTile(website[0], website[1])
      }
    }

    function refreshContextMenuEvents() {
      for (tile of document.getElementsByClassName('tile')) {
        addContextMenuEvent(tile);
      }
    }

    function refreshMiddlemouseEvents() {
      for (tile of document.getElementsByClassName('tile')) {
        addMiddlemouseEvent(tile);
      }
    }

    refreshContextMenuEvents();
    refreshMiddlemouseEvents();

    /* WEBSITE LOGOS
    ---------------------------------------------*/

    function getHost(url) {
      var result = url.match(/([^:\/\s]+)/g);
      if (result[0] == undefined || result[0] == null) {
        return
      }
      if (result[1] == undefined || result[1] == null) {
        if (result[0].match('.://')) {
          return
        }
        return result[0]
      }
      if (result[1].startsWith('www.')) {
        return result[1].substring(4, result[1].length)
      }
      return result[1]
    }

    var themedLogoDatabase = [
                            /*A*/'amazon.com',
                            /*B*/
                            /*C*/
                            /*D*/'docs.google.com',
                            /*E*/
                            /*F*/
                            /*G*/'genius.com',
                            /*H*/
                            /*I*/
                            /*J*/
                            /*K*/
                            /*L*/
                            /*M*/'music.youtube.com',
                            /*N*/'nexusmods.com',
                            /*O*/
                            /*P*/'pornhub.com',
                            /*Q*/
                            /*R*/'reddit.com', 'rap.genius.com',
                            /*S*/
                            /*T*/
                            /*U*/
                            /*V*/
                            /*W*/'wikipedia.org', 'whatsapp.com',
                            /*X*/
                            /*Y*/'youtube.com'
                            /*Z*/
                            ];

    var logoDatabase = [
                            /*A*/'aliexpress.com',
                            /*B*/'baidu.com',
                            /*C*/
                            /*D*/
                            /*E*/
                            /*F*/'facebook.com',
                            /*G*/'google.com',
                            /*H*/
                            /*I*/'imdb.com', 'instagram.com',
                            /*J*/
                            /*K*/
                            /*L*/
                            /*M*/'mail.google.com', 'morele.net',
                            /*N*/'netflix.com',
                            /*O*/
                            /*P*/
                            /*Q*/
                            /*R*/
                            /*S*/
                            /*T*/'twitter.com', 'twitch.tv', 'translate.google.com',
                            /*U*/
                            /*V*/
                            /*W*/
                            /*X*/'xda-developers.com', 'xvideos.com'
                            /*Y*/
                            /*Z*/
                            ];

    function isWebsiteLogoAvailable(host, theme) {
      for (logo of logoDatabase) {
        if (host == logo) {
          return [true, 'url("img/logo/' + host + '.png")']
        }
      }
      for (logo of themedLogoDatabase) {
        if (host == logo) {
          return [true, 'url("img/logo/' + theme + '/' + host + '.png")']
        }
      }
      return [false, null]
    }

    function setWebsiteLogo(element, host, theme) {
      var response = isWebsiteLogoAvailable(host, theme);
      if (response[0]) {
        element.style.backgroundImage = response[1];
        element.classList.add('image');
      }
    }

    function refreshImageTiles() {
      var tiles = document.getElementsByClassName('tile');
      for (tile of tiles) {
        setWebsiteLogo(tile, getHost(tile.attributes.href.nodeValue), window.localStorage.getItem('theme'));
      }
    }

    function refreshImageTilesPreview(theme) {
      var tiles = document.getElementsByClassName('tile');
      for (tile of tiles) {
        setWebsiteLogo(tile, getHost(tile.attributes.href.nodeValue), theme);
      }
    }
    refreshImageTiles();

    /* BACKGROUND
    ---------------------------------------------*/

    document.documentElement.style.setProperty('--background', window.localStorage.getItem('background'));
    if (window.localStorage.getItem('backgroundBlur') == null) {
      window.localStorage.setItem('backgroundBlur', '0px');
    }
    document.documentElement.style.setProperty('--background-image-blur', window.localStorage.getItem('backgroundBlur'));
    document.documentElement.style.setProperty('--background-image-saturation', window.localStorage.getItem('backgroundSaturation'));
    document.documentElement.style.setProperty('--background-image-hue', window.localStorage.getItem('backgroundHue'));
    document.documentElement.style.setProperty('--background-image-contrast', window.localStorage.getItem('backgroundContrast'));
    document.documentElement.style.setProperty('--background-image-brightness', window.localStorage.getItem('backgroundBrightness'));
  </script>

  <img id="settingsButton" class="toggle" onclick="openSettings()" src="img/settings.svg">
  <img id="addButton" class="toggle" onclick="openAddMenu()" src="img/add.svg">
  <div id="add" class="menu">
    <img id="closeAddButton" onclick="closeAddMenu()" src="img/close.svg" class="toggle">
    <h5>add website</h5>
    <label>Name</label>
    <input class="u-full-width" type="text" placeholder="google" id="add-name">
    <label>URL</label>
    <input class="u-full-width" type="url" placeholder="https://www.google.com/" id="add-url">
    <button onclick="addWebsite()">Add</button>
  </div>
  <div id="remove" class="menu">
    <h5>are you sure?</h5>
    <img id="closeRemoveButton" onclick="closeRemoveMenu()" src="img/close.svg" class="toggle">
    <button id="removeWebsiteButton" onclick="removeWebsite(targetName, targetUrl); closeRemoveMenu()">Remove ...</button>
    <button style="margin-right: 10px" onclick="chaos(10)">Que?</button>
  </div>
  <div id="edit" class="menu">
    <img id="closeEditButton" onclick="closeEditMenu()" src="img/close.svg" class="toggle">
    <h5>edit website</h5>
    <label>Name</label>
    <input id="editNameInput" class="u-full-width" type="text" placeholder="google" id="add-name">
    <label>URL</label>
    <input id="editURLInput" class="u-full-width" type="url" placeholder="https://www.google.com/" id="add-url">
    <button id="editWebsiteButton" onclick="editWebsite(targetName, targetUrl, document.getElementById('editNameInput').value, document.getElementById('editURLInput').value); closeEditMenu()">Edit ...</button>
  </div>
  <div id="settings" class="menu">
    <img id="closeSettingsButton" onclick="closeSettings()" src="img/close.svg" class="toggle">
    <h5>settings</h5>
    <div>
      <label>Background</label>
      <input id="backgroundInput" class="u-full-width" type="text" placeholder="direct link, color, gradient" onchange="backgroundPreview()">
    </div>
    <div>
      <label>Background Blur</label>
      <div>
        <input id="backgroundBlurRange" type="range" min="0" max="100" value="0" onmousemove="rangeUpdate(this, 'px')"
        onchange="rangeUpdate(this, 'px')" ondblclick="rangeChangeValue(this, 'px', 0)"><span>0px</span>
      </div>
    </div>
    <div>
      <label>Background Saturation</label>
      <div>
        <input id="backgroundSaturationRange" type="range" min="0" max="500" value="100" onmousemove="rangeUpdate(this, '%')"
        onchange="rangeUpdate(this, '%')" ondblclick="rangeChangeValue(this, '%', 100)"><span>100%</span>
      </div>
    </div>
    <div>
      <label>Background Hue</label>
      <div>
        <input id="backgroundHueRange" type="range" min="0" max="360" value="0" onmousemove="rangeUpdate(this, 'deg')"
        onchange="rangeUpdate(this, 'deg')" ondblclick="rangeChangeValue(this, 'deg', 0)"><span>0deg</span>
      </div>
    </div>
    <div>
      <label>Background Contrast</label>
      <div>
        <input id="backgroundContrastRange" type="range" min="0" max="500" value="100" onmousemove="rangeUpdate(this, '%')"
        onchange="rangeUpdate(this, '%')" ondblclick="rangeChangeValue(this, '%', 100)"><span>100%</span>
      </div>
    </div>
    <div>
      <label>Background Brightness</label>
      <div>
        <input id="backgroundBrightnessRange" type="range" min="0" max="500" value="100" onmousemove="rangeUpdate(this, '%')"
        onchange="rangeUpdate(this, '%')" ondblclick="rangeChangeValue(this, '%', 100)"><span>100%</span>
      </div>
    </div>
    <div>
      <label>Theme</label>
      <input id="radioLightTheme" type="radio" name="theme" onchange="themePreview()"> Light Theme<br>
      <input id="radioDarkTheme" type="radio" name="theme" onchange="themePreview()"> Dark Theme<br>
    </div>
    <div>
      <label>Background Buttons</label>
      <input id="radioLightBackgroundButtons" type="radio" name="backgroundButtons" onchange="backgroundButtonPreview()"> Light<br>
      <input id="radioDarkBackgroundButtons" type="radio" name="backgroundButtons" onchange="backgroundButtonPreview()"> Dark<br>
    </div>
    <div>
      <div class="six columns">
        <label>Search Engine</label>
        <select class="u-full-width" id="searchEngineSelect">
          <option value="Google">Google</option>
          <option value="DuckDuckGo">DuckDuckGo</option>
          <option value="Bing">Bing</option>
          <option value="Yahoo">Yahoo</option>
          <option value="Wikipedia">Wikipedia</option>
        </select>
      </div>
      <div class="six columns">
        <label>Suggestions Provider</label>
        <select class="u-full-width" id="suggestionsProviderSelect">
          <option value="Google">Google</option>
          <option value="DuckDuckGo">DuckDuckGo</option>
          <option value="Yahoo">Yahoo</option>
          <option value="Wikipedia">Wikipedia</option>
        </select>
      </div>
    </div>
    <button onclick="applySettings(); closeSettings()">Apply</button>
  </div>
  <div id="contextMenu">
    <table class="u-full-width" style="margin: 0;">
      <tbody>
        <tr>
          <td id="contextMenuAdd" onclick="openAddMenu()"><img src="img/add.svg"><bdo>Add New</bdo></td>
        </tr>
        <tr>
          <td id="contextMenuEdit" onclick="openEditMenu()"><img src="img/edit.svg"><bdo>Edit</bdo></td>
        </tr>
        <tr>
          <td id="contextMenuRemove" onclick="openRemoveMenu()"><img src="img/delete.svg"><bdo>Remove</bdo></td>
        </tr>
      </tbody>
    </table>
  </div>


  <script type="text/javascript">

    /* CONTEXT MENU
    ---------------------------------------------*/

    document.addEventListener('mouseup', function(ev) {
      document.getElementById('contextMenu').style.display = "none";
    }, false);

    /* THEME
    ---------------------------------------------*/

    if (window.localStorage.getItem('theme') == 'dark') {
      displayDarkTheme(true);
    }

    /* OPENING AND CLOSING MENUS
    ---------------------------------------------*/

    var addMenu = document.getElementById("add");
    var settings = document.getElementById("settings");
    var removeMenu = document.getElementById('remove');
    var editMenu = document.getElementById('edit');
    var menus = [
      [addMenu, false, closeAddMenu, 'add'],
      [settings, false, closeSettings, 'settings'],
      [removeMenu, false, closeRemoveMenu, 'remove'],
      [editMenu, false, closeEditMenu, 'edit']
    ];

    function closeMenus(exception) {
      if (exception != null) {
        for (menu of menus) {
          if (menu[1] && exception != menu[3]) {
            menu[2]();
          }
        }
      } else {
        for (menu of menus) {
          if (menu[1]) {
            menu[2]();
          }
        }
      }
    }

    function openAddMenu() {
      if (menus[0][1]) {
        closeAddMenu();
      } else {
        menus[0][1] = true;
        addMenu.style.animationName = "openMenu";
        addMenu.style.animationDuration = "0.25s";
        closeMenus('add');
      }
    }

    function closeAddMenu() {
      addMenu.style.animationName = "closeMenu";
      addMenu.style.animationDuration = "0.25s";
      menus[0][1] = false;
      document.getElementById("add-name").value = "";
      document.getElementById("add-url").value = "";
    }

    function openSettings() {
      if (menus[1][1]) {
        closeSettings();
      } else {
        menus[1][1] = true;
        settings.style.animationName = "openSettings";
        settings.style.animationDuration = "0.25s";
        closeMenus('settings');
      }
      if (window.localStorage.getItem('backgroundBlur') != null) {
        document.getElementById('backgroundBlurRange').value = window.localStorage.getItem('backgroundBlur').substr(0, window.localStorage.getItem('backgroundBlur').length - 2);
      } else {
        window.localStorage.setItem('backgroundBlur', '0px');
      }
      if (window.localStorage.getItem('backgroundSaturation') != null) {
        document.getElementById('backgroundSaturationRange').value = window.localStorage.getItem('backgroundSaturation').substr(0, window.localStorage.getItem('backgroundSaturation').length - 1);
      } else {
        window.localStorage.setItem('backgroundSaturation', '100%');
      }
      if (window.localStorage.getItem('backgroundHue') != null) {
        document.getElementById('backgroundHueRange').value = window.localStorage.getItem('backgroundHue').substr(0, window.localStorage.getItem('backgroundHue').length - 3);
      } else {
        window.localStorage.setItem('backgroundHue', '0deg');
      }
      if (window.localStorage.getItem('backgroundContrast') != null) {
        document.getElementById('backgroundContrastRange').value = window.localStorage.getItem('backgroundContrast').substr(0, window.localStorage.getItem('backgroundContrast').length - 1);
      } else {
        window.localStorage.setItem('backgroundContrast', '100%');
      }
      if (window.localStorage.getItem('backgroundBrightness') != null) {
        document.getElementById('backgroundBrightnessRange').value = window.localStorage.getItem('backgroundBrightness').substr(0, window.localStorage.getItem('backgroundBrightness').length - 1);
      } else {
        window.localStorage.setItem('backgroundBrightness', '100%');
      }
      if (window.localStorage.getItem('background') != null) {
        if (window.localStorage.getItem('background').startsWith('url("')) {
          document.getElementById('backgroundInput').value = window.localStorage.getItem('background').substr(5, window.localStorage.getItem('background').length - 7);
        } else {
          document.getElementById('backgroundInput').value = window.localStorage.getItem('background');
        }
      }

      if (window.localStorage.getItem('theme') == 'dark') {
        document.getElementById('radioDarkTheme').checked = true;
        document.getElementById('radioLightTheme').checked = false;
      } else {
        document.getElementById('radioLightTheme').checked = true;
        document.getElementById('radioDarkTheme').checked = false;
      }

      if (window.localStorage.getItem('backgroundButtons') == 'light') {
        document.getElementById('radioLightBackgroundButtons').checked = true;
        document.getElementById('radioDarkBackgroundButtons').checked = false;
      } else {
        document.getElementById('radioDarkBackgroundButtons').checked = true;
        document.getElementById('radioLightBackgroundButtons').checked = false;
      }

      var searchEngine = window.localStorage.getItem('searchEngine');

      if (searchEngine != null || searchEngine != undefined) {
        document.getElementById('searchEngineSelect').value = searchEngine;
      }

      var suggestionsProvider = window.localStorage.getItem('suggestionsProvider');

      if (suggestionsProvider != null || suggestionsProvider != undefined) {
        document.getElementById('suggestionsProviderSelect').value = suggestionsProvider;
      }

      rangeUpdate(document.getElementById('backgroundBlurRange'), 'px');
      document.getElementById('backgroundBlurRange').addEventListener('mousemove', blurRangeUpdate);

      rangeUpdate(document.getElementById('backgroundSaturationRange'), '%');
      document.getElementById('backgroundSaturationRange').addEventListener('mousemove', saturationRangeUpdate);

      rangeUpdate(document.getElementById('backgroundHueRange'), 'deg');
      document.getElementById('backgroundHueRange').addEventListener('mousemove', hueRangeUpdate);

      rangeUpdate(document.getElementById('backgroundContrastRange'), '%');
      document.getElementById('backgroundContrastRange').addEventListener('mousemove', contrastRange);

      rangeUpdate(document.getElementById('backgroundBrightnessRange'), '%');
      document.getElementById('backgroundBrightnessRange').addEventListener('mousemove', brightnessRange);
    }

    function closeSettings() {
      settings.style.animationName = "closeSettings";
      settings.style.animationDuration = "0.25s";
      menus[1][1] = false;
      document.getElementById('backgroundBlurRange').removeEventListener('mousemove', blurRangeUpdate);
      document.getElementById('backgroundSaturationRange').removeEventListener('mousemove', saturationRangeUpdate);
      document.getElementById('backgroundHueRange').removeEventListener('mousemove', hueRangeUpdate);
      document.getElementById('backgroundContrastRange').removeEventListener('mousemove', contrastRange);
      document.getElementById('backgroundBrightnessRange').removeEventListener('mousemove', brightnessRange);
      document.documentElement.style.setProperty('--background-image-blur', window.localStorage.getItem('backgroundBlur'));
      document.documentElement.style.setProperty('--background-image-saturation', window.localStorage.getItem('backgroundSaturation'));
      document.documentElement.style.setProperty('--background-image-hue', window.localStorage.getItem('backgroundHue'));
      document.documentElement.style.setProperty('--background-image-contrast', window.localStorage.getItem('backgroundContrast'));
      document.documentElement.style.setProperty('--background-image-brightness', window.localStorage.getItem('backgroundBrightness'));
      if (window.localStorage.getItem('backgroundButtons') == 'light') {
        displayLightBackgroundButtons();
      } else {
        displayDarkBackgroundButtons();
      }
      if (window.localStorage.getItem('theme') == 'dark') {
        displayDarkTheme(true);
        refreshImageTiles();
      } else {
        displayLightTheme(true);
        refreshImageTiles();
      }
      document.documentElement.style.setProperty('--background', window.localStorage.getItem('background'));
    }

    function applySettings() {
      if (document.getElementById('radioLightTheme').checked) {
        window.localStorage.setItem('theme', 'light');
        displayLightTheme(true);
        refreshImageTiles();
      } else {
        window.localStorage.setItem('theme', 'dark');
        displayDarkTheme(true);
        refreshImageTiles();
      }

      if (document.getElementById('backgroundInput').value != '') {
        var background = document.getElementById('backgroundInput').value;
        if (background.search('http') != -1) {
          background = 'url("' + background + '")';
        } else if (background.search('.jpg') != -1) {
          background = 'url("' + background + '")';
        } else if (background.search('.jpeg') != -1) {
          background = 'url("' + background + '")';
        } else if (background.search('.png') != -1) {
          background = 'url("' + background + '")';
        } else if (background.search('.webp') != -1) {
          background = 'url("' + background + '")';
        }
        window.localStorage.setItem('background', background);
        document.documentElement.style.setProperty('--background', window.localStorage.getItem('background'));
      }
      window.localStorage.setItem('backgroundBlur', document.getElementById('backgroundBlurRange').value + "px");
      window.localStorage.setItem('backgroundSaturation', document.getElementById('backgroundSaturationRange').value + "%");
      window.localStorage.setItem('backgroundHue', document.getElementById('backgroundHueRange').value + "deg");
      window.localStorage.setItem('backgroundContrast', document.getElementById('backgroundContrastRange').value + "%");
      window.localStorage.setItem('backgroundBrightness', document.getElementById('backgroundBrightnessRange').value + "%");
      document.documentElement.style.setProperty('--background-image-blur', window.localStorage.getItem('backgroundBlur'));
      document.documentElement.style.setProperty('--background-image-saturation', window.localStorage.getItem('backgroundSaturation'));
      document.documentElement.style.setProperty('--background-image-hue', window.localStorage.getItem('backgroundHue'));
      document.documentElement.style.setProperty('--background-image-contrast', window.localStorage.getItem('backgroundContrast'));
      document.documentElement.style.setProperty('--background-image-brightness', window.localStorage.getItem('backgroundBrightness'));

      if (document.getElementById('radioDarkBackgroundButtons').checked) {
        window.localStorage.setItem('backgroundButtons', 'dark');
        displayDarkBackgroundButtons();
      } else {
        window.localStorage.setItem('backgroundButtons', 'light');
        displayLightBackgroundButtons();
      }

      window.localStorage.setItem('suggestionsProvider', document.getElementById('suggestionsProviderSelect').value);
      window.localStorage.setItem('searchEngine', document.getElementById('searchEngineSelect').value);
      document.getElementById('searchInput').placeholder = "Search with " + window.localStorage.getItem('searchEngine');
    }

    function blurRangeUpdate() {
      var blur = document.getElementById('backgroundBlurRange').value + 'px';
      document.documentElement.style.setProperty('--background-image-blur', blur);
    }

    function saturationRangeUpdate() {
      var saturation = document.getElementById('backgroundSaturationRange').value + '%';
      document.documentElement.style.setProperty('--background-image-saturation', saturation);
    }

    function hueRangeUpdate() {
      var hue = document.getElementById('backgroundHueRange').value + 'deg';
      document.documentElement.style.setProperty('--background-image-hue', hue);
    }

    function contrastRange() {
      var contrast = document.getElementById('backgroundContrastRange').value + '%';
      document.documentElement.style.setProperty('--background-image-contrast', contrast);
    }

    function brightnessRange() {
      var brightness = document.getElementById('backgroundBrightnessRange').value + '%';
      document.documentElement.style.setProperty('--background-image-brightness', brightness);
    }

    function backgroundPreview() {
      if (document.getElementById('backgroundInput').value != '') {
        var background = document.getElementById('backgroundInput').value;
        if (background.search('http') != -1) {
          background = 'url("' + background + '")';
        } else if (background.search('.jpg') != -1) {
          background = 'url("' + background + '")';
        } else if (background.search('.jpeg') != -1) {
          background = 'url("' + background + '")';
        } else if (background.search('.png') != -1) {
          background = 'url("' + background + '")';
        } else if (background.search('.webp') != -1) {
          background = 'url("' + background + '")';
        }
        document.documentElement.style.setProperty('--background', background);
      }
    }

    function backgroundButtonPreview() {
      if (document.getElementById('radioDarkBackgroundButtons').checked) {
        displayDarkBackgroundButtons();
      } else {
        displayLightBackgroundButtons();
      }
    }

    function themePreview() {
      if (document.getElementById('radioDarkTheme').checked) {
        displayDarkTheme(true);
        refreshImageTilesPreview('dark');
      } else {
        displayLightTheme(true);
        refreshImageTilesPreview('light');
      }
    }

    function openRemoveMenu() {
      menus[2][1] = true;
      removeMenu.style.animationName = "openMenu";
      removeMenu.style.animationDuration = "0.25s";
      closeMenus('remove');
    }

    function closeRemoveMenu() {
      removeMenu.style.animationName = "closeMenu";
      removeMenu.style.animationDuration = "0.25s";
      menus[2][1] = false;
    }

    function openEditMenu() {
      menus[3][1] = true;
      editMenu.style.animationName = "openMenu";
      editMenu.style.animationDuration = "0.25s";
      closeMenus('edit');
    }

    function closeEditMenu() {
      editMenu.style.animationName = "closeMenu";
      editMenu.style.animationDuration = "0.25s";
      menus[3][1] = false;
    }

    function rangeUpdate(range, suffix) {
      var value = (100 / range.max) * range.value;
      range.style.background = 'linear-gradient(to right, #44aeeb ' + value + '%, var(--background-contrast) ' + value + '%)';
      range.nextSibling.innerText = range.value + suffix;
    }

    function rangeChangeValue(range, suffix, value) {
      range.value = value;
      value = (100 / range.max) * range.value;
      range.style.background = 'linear-gradient(to right, #44aeeb ' + value + '%, var(--background-contrast) ' + value + '%)';
      range.nextSibling.innerText = range.value + suffix;
    }

    /* WEBSITE TILES
    ---------------------------------------------*/

    function addWebsite() {
      var name = document.getElementById("add-name").value;
      var url = document.getElementById("add-url").value;
      if (localStorage.getItem("websites") != null) {
        localStorage.setItem('websites', localStorage.getItem('websites') + ',' + name + '=' + url);
      } else {
        localStorage.setItem('websites', name + '=' + url);
      }
      closeAddMenu();
      displayWebsiteTile(name, url);
      tile = document.getElementsByClassName('tile')[document.getElementsByClassName('tile').length - 1];
      setWebsiteLogo(tile, getHost(tile.attributes.href.nodeValue), window.localStorage.getItem('theme'));
      refreshContextMenuEvents();
      refreshMiddlemouseEvents();
    }

    function removeWebsiteTile(name, url) {
      var tiles = document.getElementsByClassName('tile');
      for (tile of tiles) {
        if (tile.children[0].innerText == name) {
          if (tile.attributes.href.nodeValue == url) {
            tile.remove();
            return
          }
        }
      }
      refreshContextMenuEvents();
      refreshMiddlemouseEvents();
    }

    function removeWebsite(name, url) {
      if (!localStorage.getItem('websites').endsWith((name + '=' + url))) {
        localStorage.setItem('websites', localStorage.getItem('websites').replace(name + '=' + url + ',', ''));
        removeWebsiteTile(name, url);
      } else {
        if (localStorage.getItem('websites').search(',') > -1) {
          localStorage.setItem('websites', localStorage.getItem('websites').replace(new RegExp(',' + name + '=' + url + '$'), ''));
          removeWebsiteTile(name, url);
        } else if (localStorage.getItem('websites') == name + '=' + url) {
          localStorage.removeItem('websites');
          removeWebsiteTile(name, url);
        }
      }
    }

    function editWebsite(oldName, oldURL, newName, newURL) {
      window.localStorage.setItem('websites', window.localStorage.getItem('websites').replace(oldName + '=' + oldURL, newName + '=' + newURL));
      removeWebsiteTile(oldName, oldURL);
      displayWebsiteTile(newName, newURL);
      refreshImageTiles();
      refreshContextMenuEvents();
    }

    /* SEARCH
    ---------------------------------------------*/

    function openUrl(url) {
      window.open(url, "_self")
    }

    function openUrlNewTab(url) {
      var tab = window.open(url, '_blank');
      tab.focus();
    }

    function Search(text) {
      if (text == undefined || text == null) {
        text = '';
      }

      // Percent-encoding
      var before =  ['[%]', '[!]', '[#]', '[$]', '[&]', "[']", '[(]', '[)]', '[*]', '[+]', '[,]', '[/]', '[:]', '[;]', '[=]', '[?]', '[@]', '[[]', '[]]'];
      var after =   ['%25', '%21', '%23', '%24', '%26', '%27', '%28', '%29', '%2A', '%2B', '%2C', '%2F', '%3A', '%3B', '%3D', '%3F', '%40', '%5B', '%5D'];

      for (var i = 0; i < before.length; i++) {
        text = text.replace(new RegExp(before[i], 'g'), after[i]);
      }

      var searchEngine = window.localStorage.getItem('searchEngine');

      switch (searchEngine) {
        case undefined:
        case null:
        case 'Google':
          SearchGoogle(text);
          break;
        case 'DuckDuckGo':
          SearchDuckDuckGo(text);
          break;
        case 'Bing':
          SearchBing(text);
          break;
        case 'Yahoo':
          SearchYahoo(text);
          break;
        case 'Wikipedia':
          SearchWikipedia(text);
          break;
        default:
          console.log('%c Unknown Search Engine: ' + searchEngine, 'background: #222; color: rgb(227, 160, 31)');
      }
    }

    function SearchKey(e) {
      if (document.activeElement === document.getElementById('searchInput') && e.keyCode == 13) {
          Search(document.getElementById('searchInput').value);
      } else if (selectedSuggestion != -2 && e.keyCode == 40) {
          if (selectedSuggestion != suggestionCount) {
            selectedSuggestion += 1;
          }
          selectedSuggestion %= suggestionCount;
          selectSuggestion();
      } else if (selectedSuggestion != -2 && e.keyCode == 38) {
          if (selectedSuggestion > 0) {
            selectedSuggestion -= 1;
          } else {
            selectedSuggestion = suggestionCount - 1;
          }
          selectedSuggestion %= suggestionCount;
          selectSuggestion();
      } else if (e.keyCode == 13) {
          document.getElementById("searchInput").focus();
      }
    }

    /* SEARCH SUGGESTIONS
    ---------------------------------------------*/

    var suggestionCount = 0;
    var selectedSuggestion = -2;

    function SearchSuggestion(text) {
      document.getElementById('searchInput').value = text;
      Search(text);
    }

    function showSuggestions(suggestions) {
      var elements = document.getElementById('search').firstElementChild.firstElementChild.children;
      var total;
      for (var i = 0; i < 5; i++) {
        if (suggestions[i] != undefined) {
          elements[i + 1].firstElementChild.innerText = suggestions[i];
          total = i + 1;
        }
      }
      document.getElementById('search').style.height = (46 + total * 49) + 'px';
      if (total) {
        suggestionCount = total;
        selectedSuggestion = -1;
        removeSuggestionClasses();
      }
    }

    function hideSuggestions() {
      if (document.activeElement === document.getElementById('searchInput')) {
        return
      }
      document.getElementById('search').style.height = '45px';
      suggestionCount = 0;
      selectedSuggestion = -2;
    }
    document.onmouseup = hideSuggestions;

    var searchLastKeyStroke = Date.now();
    var lastQuery;

    function getQuery(e, q) {
      if (q == '' || q == lastQuery || e.keyCode == 38 || e.keyCode == 40) {
        return
      }
      lastQuery = q;
      searchLastKeyStroke = Date.now();

      setTimeout(function() {
        var elapsed = Date.now() - searchLastKeyStroke;

        if (elapsed >= 200) { // 200ms

          var suggestionsProvider = window.localStorage.getItem('suggestionsProvider');

          switch (suggestionsProvider) {
            case undefined:
            case null:
            case 'Google':
              getQueryGoogle(q);
              break;
            case 'DuckDuckGo':
              getQueryDuckDuckGo(q);
              break;
            case 'Bing':
              getQueryBing(q);
              break;
            case 'Yahoo':
              getQueryYahoo(q);
              break;
            case 'Wikipedia':
              getQueryWikipedia(q);
              break;
            default:
              console.log('%c Unknown Suggestions Provider: ' + suggestionsProvider, 'background: #222; color: rgb(227, 160, 31)');
          }
        }

      }, 200);
    }

    function removeSuggestionClasses() {
      var elements = document.getElementById('search').firstElementChild.firstElementChild.children;
      for (var i = 1; i < suggestionCount + 1; i++) {
        if (elements[i].classList.item('selected')) {
          elements[i].classList.remove('selected');
        }
      }
    }

    function selectSuggestion() {
      removeSuggestionClasses();
      var elements = document.getElementById('search').firstElementChild.firstElementChild.children;
      elements[selectedSuggestion + 1].classList.add('selected');
      document.getElementById('searchInput').value = elements[selectedSuggestion + 1].innerText;
    }

    /* SEARCH ENGINES
    ---------------------------------------------*/

    function getQueryGoogle(q) {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          showSuggestions(JSON.parse(this.responseText)[1]);
        }
      };
      xmlhttp.open("GET", "https://cors-anywhere.herokuapp.com/http://suggestqueries.google.com/complete/search?client=firefox&q=" + q + true);
      xmlhttp.send();
    }

    function getQueryGoogle(q, lang) {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          showSuggestions(JSON.parse(this.responseText)[1]);
        }
      };
      xmlhttp.open("GET", "https://cors-anywhere.herokuapp.com/http://suggestqueries.google.com/complete/search?client=firefox&q=" + q + "&hl=" + lang, true);
      xmlhttp.send();
    }

    function SearchGoogle(text) {
      var url = "http://www.google.com/search?q=" + text;
      window.open(url,'_self');
    }

    function getQueryDuckDuckGo(q) {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          showSuggestions(JSON.parse(this.responseText)[1]);
        }
      };
      xmlhttp.open("GET", "https://cors-anywhere.herokuapp.com/https://ac.duckduckgo.com/ac/?q=" + q + "&type=list", true);
      xmlhttp.send();
    }

    function SearchDuckDuckGo(text) {
      var url = "https://duckduckgo.com/?q=" + text;
      window.open(url,'_self');
    }

    function getQueryWikipedia(q) {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          showSuggestions(JSON.parse(this.responseText)[1]);
        }
      };
      xmlhttp.open("GET", "https://en.wikipedia.org/w/api.php?action=opensearch&origin=*&search=" + q, true);
      xmlhttp.send();
    }

    function SearchWikipedia(text) {
      var url = "https://en.wikipedia.org/w/index.php?search=" + text;
      window.open(url,'_self');
    }

    function getQueryYahoo(q) {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          array = JSON.parse(this.responseText.substr(this.responseText.indexOf('{'), this.responseText.lastIndexOf('}'))).gossip.results;
          var results = [];
          for (var i = 0; i < array.length; i++) {
            results[i] = array[i].key;
          }
          showSuggestions(results);
        }
      };
      xmlhttp.open("GET", "https://cors-anywhere.herokuapp.com/https://sugg.search.yahoo.net/sg/?output=jsonp&nresults=10&command=" + q, true);
      xmlhttp.send();
    }

    function SearchYahoo(text) {
      var url = "https://search.yahoo.com/search?p=" + text;
      window.open(url,'_self');
    }

    function SearchBing(text) {
      var url = "https://www.bing.com/search?q=" + text;
      window.open(url,'_self');
    }

    function chaos(iterations) {

      function randomColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';
        for (var i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
      }

      function randomNumber(min, max) {
        return Math.round(min + (Math.random() * (max - min)));
      }

      function randomNumberF(min, max) {
        return min + (Math.random() * (max - min));
      }

      function randomValue(values) {
        return values[randomNumber(0, values.length - 1)]
      }

      for (var i = 0; i < iterations; i++) {
        var obj = document.all[randomNumber(0, document.all.length - 1)];
        switch (randomNumber(0, 5)) {
          case 0:
            obj.style.backgroundColor = randomColor();
            break;
          case 1:
            obj.style.borderColor = randomColor();
            obj.style.borderWidth = randomNumber(0, 10) + 'px';
            obj.style.borderStyle = randomValue(['dashed', 'dotted', 'double', 'groove', 'outset', 'ridge', 'solid', 'none', 'none', 'none', 'none', 'none', 'none', 'none']);
            break;
          case 2:
            if (randomNumber(0, 1) == 1) {
              obj.style.scale = randomNumberF(0.75, 1.25);
            } else {
              obj.style.scale = '';
            }
            break;
          case 3:
            if (randomNumber(0, 1) == 1) {
              obj.style.boxShadow = randomNumber(0, 2) + 'px ' + randomNumber(0, 2) + 'px ' + randomNumber(0, 2) + 'px ' + randomNumber(0, 2) + 'px';
            } else {
              obj.style.boxShadow = '';
            }
            break;
          case 4:
            if (randomNumber(0, 1) == 1) {
              obj.style.rotate = randomNumber(0, 360) + 'deg';
            } else {
              obj.style.rotate = '';
            }
            break;
          case 5:
            obj.style.color = randomColor();
            break;
          default:
        }
      }
    }
  </script>
</body>
</html>
